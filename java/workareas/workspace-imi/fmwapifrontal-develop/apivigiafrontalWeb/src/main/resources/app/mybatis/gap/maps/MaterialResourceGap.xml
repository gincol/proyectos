<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="es.bcn.imi.framework.vigia.frontal.gap.inventary.orm.dao.MaterialResourceGapDao">
   
    <select id="getMaterialResourcesGap" resultType="es.bcn.vigia.fmw.libcommons.integration.orm.model.gap.MaterialResourceGap">
        SELECT 
	      	CODI AS code, 
	      	TIPUS_RM_CODI AS type,
	      	TIPUS_RM_DESCRIPCIO AS typeDescription,
	      	CONTRACTA_CODI AS codeContract, 
	      	ESTAT_CODI AS state,
			ESTAT_DESCRIPCIO AS statusDescription,
			INSTALACIO_CODI AS codeInstallation,
			INSTALACIO_DESC AS installationDescription,
			SUBJECTE_AMORT AS amortizationSubject,
			TIPUS_TITULARITAT AS codeTypeTitularity,
			DATA_INICI AS dateStart,
			DATA_FI AS dateEnd
		FROM 
			VW_RRMM
		WHERE 
			CODI = #{code}	
		AND 
			DATA_INICI <![CDATA[<=]]> SYSDATE AND (DATA_FI  <![CDATA[>=]]> SYSDATE OR DATA_FI IS NULL)			
    </select>
    
</mapper>
