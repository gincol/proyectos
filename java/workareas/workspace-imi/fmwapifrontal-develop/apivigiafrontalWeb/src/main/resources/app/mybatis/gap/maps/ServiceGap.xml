<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="es.bcn.imi.framework.vigia.frontal.gap.execution.orm.dao.ServiceGapDao">
   
    <select id="getServicesGap" parameterType="java.util.Map" resultType="es.bcn.vigia.fmw.libcommons.integration.orm.model.gap.ServiceGap">
        SELECT 
			CODI AS codeService,
			DESCRIPCIO AS descriptionService,
			GRUP_CODI AS codeGroupService,
			GRUP_DESCRIPCIO AS descriptionGroupService,
			TIPUS_CODI AS codeTypeService,
			TIPUS_DESCRIPCIO AS descriptionTypeService,
			TRACTAMENT_CODI AS codeTreatment,
			TRACTAMENT_DESCRIPCIO AS descriptionTreatment,
			DATA_INICI AS dateStart,
			DATA_FI AS dateEnd
		FROM 
			VW_DM_SERVEI
		WHERE 
			TRACTAMENT_CODI LIKE   '%' || #{codeTreatment}
		AND
			DATA_INICI <![CDATA[<=]]> SYSDATE AND (DATA_FI  <![CDATA[>=]]> SYSDATE OR DATA_FI IS NULL)
	</select>
    
</mapper>