<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="es.bcn.imi.framework.vigia.frontal.inventary.orm.dao.ValueListDao">
  
    <select id="getValueLists" resultType="es.bcn.vigia.fmw.libcommons.integration.orm.model.ValueList">
        SELECT
            VALOR AS value,
            DESCRIPCIO AS description
        FROM 
            TB_LLISTA_VALOR
        WHERE
            TIPUS = UPPER(#{type})
		AND
            DATA_INICI  <![CDATA[ <= ]]> SYSDATE AND (DATA_FI  <![CDATA[ >= ]]> SYSDATE OR DATA_FI IS NULL)
    </select>
    
	<select id="getDomains" resultType="java.lang.String">
		SELECT 
			DISTINCT UPPER(TIPUS)
		FROM 
			TB_LLISTA_VALOR
	</select>
    
	<select id="getDomainValues" parameterType="java.util.Map" resultType="es.bcn.vigia.fmw.libcommons.integration.orm.model.ValueList">
		SELECT 
            VALOR AS value,
            DESCRIPCIO AS description
		FROM 
			TB_LLISTA_VALOR
		WHERE
			1=1
			<if test="name != null">
				AND UPPER(TIPUS) = UPPER(#{name})	
			</if>		
			<if test="dateReference != null">
				AND DATA_INICI <![CDATA[<=]]> TO_TIMESTAMP(#{dateReference}, 'DD-MM-YYYY HH24:MI:SS') AND (DATA_FI IS NULL OR DATA_FI <![CDATA[>=]]> TO_TIMESTAMP(#{dateReference}, 'DD-MM-YYYY HH24:MI:SS'))
			</if>
	</select>
    
</mapper>