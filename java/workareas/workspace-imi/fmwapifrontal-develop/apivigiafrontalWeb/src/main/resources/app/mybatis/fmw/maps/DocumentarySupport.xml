<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="es.bcn.imi.framework.vigia.frontal.inventary.orm.dao.DocumentarySupportDao">
    
    <select id="getDocumentarySupports" resultType="es.bcn.vigia.fmw.libcommons.integration.orm.model.DocumentarySupport">
        (SELECT
		    CODI_CONTRACTA AS codeContract,
			CODSUPORTDOCUMENTAL AS codeContractDocument,
			DATA_CREACIO AS dataCreationDocument,
			CODDOCUMENTMUNICIPAL AS codeMunicipalDocument,
			NOM_DOCUMENT AS nameDocument,
			TIPUS_DOCUMENT AS typeDocument,
			OBSERVACIONS AS observations,
			CODI_ACTUACIO AS codeActuation,
			USER_INSERT AS userInsert,
			USER_DELETE AS userDelete
        FROM 
            TB_DOCUMENT_ELEMENT
        WHERE
            DATA_INICI  <![CDATA[ <= ]]> SYSDATE 
        <if test="checkStatusDelete != null">
			AND (DATA_FI  <![CDATA[ >= ]]> SYSDATE OR DATA_FI IS NULL)
		</if>
        <if test="codeContract != null">
        	AND
        		CODI_CONTRACTA = UPPER(#{codeContract})
        </if>
        <if test="codeContractDocument != null">	     
			AND
            	CODSUPORTDOCUMENTAL = UPPER(#{codeContractDocument})
        </if>   
         <if test="codeEntity != null">	     
			AND
            	CODI_ELEMENT = #{codeEntity}
        </if>   
        ) UNION
        (SELECT
		    CODI_CONTRACTA AS codeContract,
			CODSUPORTDOCUMENTAL AS codeContractDocument,
			DATA_CREACIO AS dataCreationDocument,
			CODDOCUMENTMUNICIPAL AS codeMunicipalDocument,
			NOM_DOCUMENT AS nameDocument,
			TIPUS_DOCUMENT AS typeDocument,
			OBSERVACIONS AS observations,
			CODI_ACTUACIO AS codeActuation,
			USER_INSERT AS userInsert,
			USER_DELETE AS userDelete
        FROM 
            TB_DOCUMENT_DESPESES
        WHERE
            DATA_INICI  <![CDATA[ <= ]]> SYSDATE 
        <if test="checkStatusDelete != null">
			AND (DATA_FI  <![CDATA[ >= ]]> SYSDATE OR DATA_FI IS NULL)
		</if>
        <if test="codeContract != null">
        	AND
        		CODI_CONTRACTA = UPPER(#{codeContract})
        </if>
        <if test="codeContractDocument != null">	     
			AND
            	CODSUPORTDOCUMENTAL = UPPER(#{codeContractDocument})
        </if>   
         <if test="codeEntity != null">	     
			AND
            	CODI_INSTALACIO = #{codeEntity}
        </if>   
        )
    </select>
    
    </mapper>