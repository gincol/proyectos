<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="es.bcn.imi.framework.vigia.frontal.gap.planification.orm.dao.PlanificationGapDao">
   
    <select id="getPlanificationsGap" parameterType="java.util.Map" resultType="es.bcn.vigia.fmw.libcommons.integration.orm.model.gap.PlanningGap">
        SELECT 
			CONTRACTA_CODI AS codeContract,
			ITINERARI_CODI AS codeItinerary,
			ITINERARI_VERSIO AS versionItinerary,
			VERSIO AS version,
			DATA_INICI AS dateStart,
			DATA_FI AS dateEnd,
			USUARI_CODI AS codeUser,
			DATA_PLANIFICACIO AS datePlanification,
			PREU AS price,
			TIPUS_DIA AS typeDay
		FROM 
			VW_PLANIFICACIO
		WHERE 
			ITINERARI_CODI = #{codeItinerary}
		AND
			DATA_INICI <![CDATA[<=]]> SYSDATE AND (DATA_FI  <![CDATA[>=]]> SYSDATE OR DATA_FI IS NULL)
		AND 
			DATA_PLANIFICACIO = TRUNC(TO_DATE(#{dateExecution},'DD/MM/YYYY hh24:mi:ss'))	
	</select>
    
</mapper>
	
