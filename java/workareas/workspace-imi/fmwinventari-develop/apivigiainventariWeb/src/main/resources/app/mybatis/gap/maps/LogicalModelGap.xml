<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="es.bcn.imi.framework.vigia.inventari.integration.orm.dao.gap.LogicalModelGapDao">
   
    <select id="selectMclMassive" parameterType="java.util.Map" resultType="es.bcn.vigia.fmw.libcommons.integration.orm.model.gap.MclGap">
    	SELECT
			CODI_CONTRACTA as codeContract,
	      	CODI_UBICACIO AS codeUbication,
	      	CODI_MCL AS code, 
			DATA_INICI as dateStart,
			DATA_FI as dateEnd
		FROM 
			VW_MASIVA_MOBILIARI_LOGIC
		WHERE 
			CODI_CONTRACTA = #{codeContract}
			<if test="dateReference == null">
				AND	DATA_INICI <![CDATA[<=]]> SYSDATE AND (DATA_FI IS NULL OR DATA_FI <![CDATA[>=]]> SYSDATE)
			</if>			
			<if test="dateReference != null">
				AND DATA_INICI <![CDATA[<=]]> TO_TIMESTAMP(#{dateReference}, 'DD-MM-YYYY HH24:MI:SS') AND (DATA_FI IS NULL OR DATA_FI <![CDATA[>=]]> TO_TIMESTAMP(#{dateReference}, 'DD-MM-YYYY HH24:MI:SS'))
			</if>
    </select>
   
    <select id="selectMcl" parameterType="java.util.Map" resultType="es.bcn.vigia.fmw.libcommons.integration.orm.model.gap.MclGap">
    	SELECT
			MCL.CONTRACTISTA_CODI as codeContract,
	      	MCL.UBICACIO_CODI AS codeUbication,
			MCL.CODI as code,
			MCL.DATA_INICI as dateStart,
			MCL.DATA_FI as dateEnd,
			MCF.CODI as codeMCF,
			MCF.DATA_INICI as dateStartMCF,
			MCF.DATA_FI as dateEndMCF,
			MCL.TIPUS_UBICACIO_CODI as typeUbication,
			MCL.TIPUS_CODI as type,
			MCL.FRACCIO_CODI as typeFraction,
			MCL.POSICIO_X as coordinateX,
			MCL.POSICIO_Y as coordinateY,
			MCL.POSICIO as positionUbication			
		FROM 
			VW_MOBILIARI_LOGIC MCL
		LEFT JOIN
			VW_MOBILIARI_FISIC MCF ON (MCF.CODI = MCL.MOBFISIC_CODI AND MCF.MCL = MCL.CODI)
		WHERE 
			MCL.CONTRACTISTA_CODI = #{codeContract}
			<if test="code != null">				
		    	AND MCL.CODI = #{code}	
			</if>
			<if test="dateReference == null">
				AND	MCL.DATA_INICI <![CDATA[<=]]> SYSDATE AND (MCL.DATA_FI IS NULL OR MCL.DATA_FI <![CDATA[>=]]> SYSDATE)
			</if>			
			<if test="dateReference != null">
				AND MCL.DATA_INICI <![CDATA[<=]]> TO_TIMESTAMP(#{dateReference}, 'DD-MM-YYYY HH24:MI:SS') AND (MCL.DATA_FI IS NULL OR MCL.DATA_FI <![CDATA[>=]]> TO_TIMESTAMP(#{dateReference}, 'DD-MM-YYYY HH24:MI:SS'))
			</if>
    </select>
   
</mapper>