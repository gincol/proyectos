<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="es.bcn.imi.framework.vigia.inventari.integration.orm.dao.gap.PhysicalModelGapDao">
   
    <select id="selectPhysicalModelMassive" parameterType="java.util.Map" resultType="es.bcn.vigia.fmw.libcommons.integration.orm.model.gap.McfGap">
    	SELECT
			CONTRACTISTA_CODI as codeContract,
	      	CODI_UBICACIO AS codeUbication,
	      	CODI_MCL AS codeMCL, 
	      	CODI_MCF AS code, 
			DATA_INICI as dateStart,
			DATA_FI as dateEnd
		FROM 
			VW_MASIVA_MOBILIARI_FISIC
		WHERE 
			CONTRACTISTA_CODI = #{codeContract}
			<if test="dateReference == null">
				AND	DATA_INICI <![CDATA[<=]]> SYSDATE AND (DATA_FI IS NULL OR DATA_FI <![CDATA[>=]]> SYSDATE)
			</if>			
			<if test="dateReference != null">
				AND DATA_INICI <![CDATA[<=]]> TO_TIMESTAMP(#{dateReference}, 'DD-MM-YYYY HH24:MI:SS') AND (DATA_FI IS NULL OR DATA_FI <![CDATA[>=]]> TO_TIMESTAMP(#{dateReference}, 'DD-MM-YYYY HH24:MI:SS'))
			</if>
    </select>
   
    <select id="selectPhysicalModel" parameterType="java.util.Map" resultType="es.bcn.vigia.fmw.libcommons.integration.orm.model.gap.McfGap">
    	SELECT
			CONTRACTISTA as codeContract,
			UBICACIO as codeUbication,
			MCL as codeMCL,
			CODI as code,
			ESTAT_CODI as state,
			MARCA_CODI as branch,
			TIPUS_CODI as type,
			FRACCIO_CODI as typeFraction,
			DATA_INICI as dateStart,
			DATA_FI as dateEnd,
			CODI_INSTALACIO as installation,
			RFID as rfid
		FROM
			VW_MOBILIARI_FISIC
		WHERE 
			CONTRACTISTA = #{codeContract}
			<if test="code != null">				
		    	AND CODI = #{code}	
			</if>
			<if test="dateReference == null">
				AND	DATA_INICI <![CDATA[<=]]> SYSDATE AND (DATA_FI IS NULL OR DATA_FI <![CDATA[>=]]> SYSDATE)
			</if>			
			<if test="dateReference != null">
				AND DATA_INICI <![CDATA[<=]]> TO_TIMESTAMP(#{dateReference}, 'DD-MM-YYYY HH24:MI:SS') AND (DATA_FI IS NULL OR DATA_FI <![CDATA[>=]]> TO_TIMESTAMP(#{dateReference}, 'DD-MM-YYYY HH24:MI:SS'))
			</if>
    </select>
    
    <select id="selectPhysicalModelAmortization" parameterType="java.util.Map" resultType="es.bcn.vigia.fmw.libcommons.integration.orm.model.gap.PhysicalModelAmortizationGap">
    	SELECT
			CODI_USUARI as codeUser,
			CODI_CONTRACTISTA as codeContract,
			PERIODE as period,
			CODI_FRACCIO as codeFraction,
			CODI_TERRITORI as codeTerritory,
			CODI_TIPUS_MOBILIARI as codeTypeMCF,
			CODI_MARCA as codeBrand,
			CODI_GRUP_SERVEI as codeGroupService,
			NUM_ELEMENTS as numElements,
			CONCEPTE as concept,
			PREU_AGREGAT as amountAggregate,
			'' as percentageFunding,
			INTERESSOS as inerests,
			VALOR_AMORTITZACIO as valueAmortization,
			DATA_INICI as dateStart,
			DATA_FI as dateEnd,
			DATA_ULTIMA_CERTIFICACIO as dateLastCertification
		FROM 
			VW_AMORT_AGREGADA
		WHERE 
			CODI_CONTRACTISTA = #{codeContract}
			<if test="codeFraction != null">
				AND CODI_FRACCIO = #{codeFraction}
			</if>
			<if test="codeTerritory != null">
				AND CODI_TERRITORI = #{codeTerritory}
			</if>
			<if test="codeType != null">
				AND CODI_TIPUS_MOBILIARI = #{codeType}
			</if>
			<if test="codeGroup != null">
				AND CODI_GRUP_SERVEI = #{codeGroup}
			</if>
    </select>
   
</mapper>